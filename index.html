<!DOCTYPE html>
<html lang="en">

<head>
  <!--CSS-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" type="image/png" href="/img/logo.png">

  <!--Google Fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;700&display=swap" rel="stylesheet">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZWEVZ0Q8NW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-ZWEVZ0Q8NW');
  </script>
  
  <title>Pi eCard</title>

  <script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    const Pi = window.Pi;
    Pi.init({
      version: "2.0",
      sandbox: false
    })
  </script>
</head>

<body>
  <!--   Invoice -->
  <div id="a" class="box" onclick="activeBox(a)">
    <h3>Invoice ↓</h3>
    <br>
    <div id="createInvoice">
      <form action="/invoice" method="POST" id="form">
        <label for="amount">Enter amount:</label><br>
        <input id="amount" name="amount" type="number" required></input><br>
        <label for="memo">Add memo:</label><br>
        <input id="memo" name="memo" type="text"></input><br>
        <input type="button" value="Create" id="invoice_btn" onclick="mainnet()"></input>
      </form>
    </div>
    <br>
    <div id="invoiceStatusDiv">
      <h4>Invoice Status</h4>
      <p2 id="invoiceProgress">Create an invoice to take a payment</p2><br>
    </div>
    <div id="qrcode"></div>
  </div>

  <!--   Pay -->
  <div id="b" class="box" onclick="activeBox(b)">
    <h3>Pay ↑</h3><br>
    
    <img src="/img/blackqr.png" id="qrImg" class="landing"></img>

    <div id="container">
<!--       <button id="btn-scan-qr">Camera</button> -->
      <button onclick="mainnet()">Camera</button>
      <canvas hidden="" id="qr-canvas"></canvas>
      <div id="qr-result" hidden="">
        <br><br><b>Payment ID:</b> <span id="outputData"></span><br>
      </div><br>
      <!--         <button onclick="payUsername()">Pay by username</button> -->
    </div><br>
    <div id="payStatusDiv">
      <h4>Payment Status</h4>
      <a id="payStatus">Click & to scan QR code to start the payment</a><br>
    </div>
  </div>

  <!--   Withdraw -->
  <div id="c" class="box" onclick="activeBox(c)">
    <h3>Withdraw</h3>

    <p2>Balance:</p2>
    <a id="balance">loading..</a><br><br>

    <form action="/withdraw" method="POST" id="form">
      <input id="withdrawAmount" name="amount" type="number" placeholder="Enter amount.." required></input>
      <input type="button" id="max" value="Max" onclick="maxWithdrawal()"></input>
    </form><br>
    <button onclick="mainnet()">Withdraw</button><br><br>
    
    <p2 class="c" id="balanceTag">Balance: <a class="c" id="balanceTwo"></a></p2>
    <a class="c" id="name"></a>
    <img src="/img/card.png" id="card"></img>
  </div>

  <!--   History -->
  <div id="d" class="box" onclick="activeBox(d)">
    <h3>History</h3>

    <p2>Logged in as:</p2>
    <a id="username">loading..</a><br><br>

    <div id="historySection"></div>
  </div>

  <!--   Floating tab -->
  <div id="float">
    <a id="piBrowser" onclick="openBrowser()">Pi</a>
    <a style="font-size:24px" class="fa" onclick="openInfo()">&#xf05a;</a>
    <a class="fa" onclick="location.href='/'">&#xf021;</a>
  </div>

  <!--     Modals -->
  <div class="modal" id="info">
    <div class="modal-dialog">
      <header style="color: #b44afb" class="modal-header">
        <h3>Welcome to Pi eCard
          <button class="close-modal" style="width: 40px;" onclick="closeInfo()">✕</button>
        </h3>
      </header>
      <section class="modal-content">
        <h4>What is Pi eCard?</h4><br>
        <p3> Pi eCard is the easy POS (Point of Sale) system for the Pi Network, enabling in-person vendors and Pioneers to invoice others without the need to type in long public keys. The status of the payment can be seen at any stage by both the vendor and the client for clarity and peace of mind. </p3><br><br><br>

        <h4>How to use Pi eCard- Vendors:</h4><br>
        <ol>
          <li>
            Click on the 'Invoice' box and enter the amount you want to invoice and a small memo for your personal use.
          </li>
          <li>
            Click 'Create' and wait for the QR code to appear. Ask your client to scan the QR code (see below).
          </li>
          <li>
            Wait for the client to complete their Pi payment flow and watch the status bar for updates.
          </li>
          <li>
            Once the client has completed the payment flow, the status bar will inform you of its completion and you can see the value added to your app's balance. You can withdraw this to your Pi Wallet at any time, or keep it safely in the Pi eCard app.
          </li>
        </ol><br><br>

        <h4>How to use Pi eCard- Client:</h4><br>
        <ol>
          <li>
            Ensuring you are in the Pi Browser, click the 'Scan QR' button and allow the camera permission.
          </li>
          <li>
            Point the camera at the QR code. You will be alerted of the transaction once scanned.
          </li>
          <li>
            Click 'ok' on the popup to confirm the payment.
          </li>
          <li>
            Complete the standard Pi Payment flow.
          </li>
          <li>
            The payment will now be complete, check with the vender to verify with them.
          </li>
        </ol>

      </section>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <script src="js/pipayment.js"></script>
  <script src="js/scripts.js"></script>
  <script src="js/routes.js"></script>
  <script src="https://kit.fontawesome.com/3aea44e36d.js" crossorigin="anonymous"></script>

  <script>
    if (sessionStorage.userSession !== null) {
      myProfile();
    }
    if (navigator.userAgent.toLowerCase().indexOf("pibrowser") >= 0) {
      document.getElementById("piBrowser").style.display = "none";
    }
    
    function mainnet() {
      alert("Payments are now paused until Mainnet!");
    }
  </script>

</body>

</html>
